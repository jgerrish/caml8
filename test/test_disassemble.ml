open Stdio
open Base
open Caml8_lib

let%expect_test "Test Fische.ch8" =
  let in_ = In_channel.create "../resources/Fishie.ch8" in
  Disassembler.disassemble ~in_ ~out:Out_channel.stdout;

  [%expect {|
    0x0200 CLS
    0x0202 LD         I, 0x220
    0x0204 LD         V2, 0x8
    0x0206 LD         V0, 0xf8
    0x0208 ADD        V0, 0x8
    0x020a LD         V1, 0x10
    0x020c SNE        V0, 0x20
    0x020e JP         0x20e
    0x0210 DRW        V1, V0, 0x8
    0x0212 ADD        I, V2
    0x0214 ADD        V1, 0x8
    0x0216 SNE        V1, 0x30
    0x0218 JP         0x208
    0x021a JP         0x210
    0x021c DATA       0x0000
    0x021e DATA       0x0000
    0x0220 DATA       0x0000
    0x0222 DATA       0x0000
    0x0224 DATA       0x0018
    0x0226 SE         Vc, 0x3c
    0x0228 DATA       0x0000
    0x022a DATA       0x0000
    0x022c DATA       0x0000
    0x022e DATA       0x0000
    0x0230 DATA       0x0000
    0x0232 DATA       0x0000
    0x0234 DATA       0x0000
    0x0236 DATA       0x0000
    0x0238 DATA       0x0000
    0x023a DATA       0x0000
    0x023c DATA       0x0000
    0x023e DATA       0x0000
    0x0240 SE         Ve, 0x3f
    0x0242 SE         Vf, 0x3b
    0x0244 SE         V9, 0x38
    0x0246 SE         V8, 0x38
    0x0248 DATA       0x0000
    0x024a OR         V0, Vc
    0x024c DATA       0xe7ff
    0x024e ADD        Ve, 0x3c
    0x0250 DATA       0x001f
    0x0252 DATA       0xfff9
    0x0254 SHR        V0, 0x80
    0x0256 DATA       0x0303
    0x0258 DATA       0x0080
    0x025a DATA       0xe0f0
    0x025c ADD        V8, 0x38
    0x025e JP         0xc1c
    0x0260 SE         V8, 0x38
    0x0262 SE         V9, 0x3b
    0x0264 SE         Vf, 0x3f
    0x0266 SE         Ve, 0x3c
    0x0268 ADD        V8, 0xfc
    0x026a DATA       0xfecf
    0x026c Xor        V7, V0
    0x026e DATA       0x0100
    0x0270 DATA       0x0000
    0x0272 DATA       0x0000
    0x0274 Xor        V0, Ve
    0x0276 DATA       0xff7f
    0x0278 JP         0xc38
    0x027a SE         V8, 0x70
    0x027c DATA       0xf0e0
    0x027e SHR        V0, 0x0
    0x0280 SE         Vc, 0x18
    0x0282 DATA       0x0000
    0x0284 DATA       0x0000
    0x0286 DATA       0x0000
    0x0288 DATA       0x0000
    0x028a DATA       0x0000
    0x028c DATA       0x0000
    0x028e DATA       0x0000
    0x0290 DATA       0x0000
    0x0292 DATA       0x0000
    0x0294 DATA       0x0000
    0x0296 DATA       0x0000
    0x0298 DATA       0x0000
    0x029a DATA       0x0000
    0x029c DATA       0x0000
    0x029e DATA       0x0000 |}]
